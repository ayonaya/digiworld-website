<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>DigiWorld - Home</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;600;700;800;900&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary: #f57224;
      --primary-dark: #d45703;
      --accent: #fe724c;
      --card-bg: #fff;
      --badge-green: #28a745;
      --badge-green-light: #e9f7ec;
      --badge-red: #ff3a5e;
      --bg: #f6f6fa;
      --border: #eee;
      --shadow: 0 6px 32px #f5722420, 0 2px 6px #0001;
      --radius: 18px;
    }
    html, body {
      background: var(--bg);
      font-family: 'Nunito Sans', 'Segoe UI', Arial, sans-serif;
      margin: 0;
      color: #1a1a1a;
    }
    /* --- NEW HEADER, NAV, & UI STYLES --- */
    header.site-header {
      background: linear-gradient(90deg, #fd7e1a 0%, #ff3a5e 100%);
      color: #fff;
      box-shadow: 0 2px 16px #f5722433;
      border-radius: 0 0 18px 18px;
      position: sticky;
      top: 0;
      z-index: 1000;
      padding-bottom: 6px;
      transition: transform 0.3s ease-out, opacity 0.3s;
    }
    header.site-header.header-hidden {
      transform: translateY(-100%);
      opacity: 0;
    }
    .header-main-pro {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 16px 9px 16px;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }
    .logo-pro {
      font-size: 2.3rem;
      font-weight: 900;
      letter-spacing: -2px;
      color: #fff;
      text-shadow: 0 3px 12px #0002;
    }
    nav {
      display: flex;
      gap: 15px;
    }
    .nav-link-pro {
      font-size: 1.05rem;
      padding: 7px 17px;
      color: #fff;
      border-radius: 11px;
      font-weight: 700;
      text-decoration: none;
      transition: background 0.2s;
    }
    .nav-link-pro.active, .nav-link-pro:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    .lang-currency-wrap {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .dropdown { position: relative; }
    .dropdown-toggle {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: #fff;
      font-size: 1rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      border-radius: 20px;
      padding: 8px 15px;
      transition: background 0.2s;
    }
    .dropdown-toggle:hover { background: rgba(255, 255, 255, 0.3); }
    .dropdown-menu {
      position: absolute;
      top: 120%;
      right: 0;
      min-width: 150px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 24px #fe724c26;
      z-index: 50;
      display: none;
      padding: 5px;
      animation: fadeIn 0.2s ease-out;
    }
    .dropdown.open .dropdown-menu { display: block; }
    .dropdown-item {
      padding: 10px 15px;
      cursor: pointer;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 7px;
      color: #fe724c;
      border-radius: 7px;
      transition: background 0.12s, color 0.13s;
    }
    .dropdown-item:hover { background: #ffe4d1; color: #d45703; }
    .auth-btn, .account-btn {
      background: rgba(255, 255, 255, 0.2);
      color: #fff;
      border: none;
      border-radius: 20px;
      padding: 8px 18px;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.2s;
    }
    .auth-btn:hover, .account-btn:hover { background: rgba(255, 255, 255, 0.3); }
    .account-menu {
        display: none;
        position: absolute;
        right: 0;
        top: 120%;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 24px #fe724c26;
        padding: 5px;
        z-index: 1100;
    }
    .account-dropdown.open .account-menu { display: block; }
    .account-menu a, .account-menu button {
        display: block;
        padding: 10px 15px;
        color: var(--primary-dark);
        text-decoration: none;
        font-weight: 700;
        background: none;
        border: none;
        width: 100%;
        text-align: left;
        cursor: pointer;
    }
    .account-menu a:hover, .account-menu button:hover { background: #fde8e0; }
    .cart-btn {
      background: #fff;
      color: var(--primary);
      border: none;
      border-radius: 50px;
      padding: 10px 20px;
      font-size: 1.1rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      box-shadow: 0 2px 8px #00000022;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .cart-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px #00000033; }
    .cart-icon-badge {
      background: var(--primary-dark);
      color: #fff;
      border-radius: 50%;
      font-size: 0.9em;
      padding: 2px 8px;
      font-weight: bold;
    }
    .search-bar-modern {
        display: flex;
        align-items: center;
        background: #fff;
        border-radius: 24px;
        padding: 5px 10px;
        box-shadow: 0 2px 12px #0001;
        margin: 12px auto 16px auto;
        max-width: 600px;
        position: relative;
    }
    .search-bar-modern input {
        flex: 1;
        border: none;
        outline: none;
        font-size: 1.1em;
        padding: 10px;
        background: transparent;
    }
    .search-btn-modern {
        background: var(--primary);
        color: #fff;
        border: none;
        border-radius: 20px;
        padding: 8px 24px;
        font-size: 1.1em;
        font-weight: bold;
        cursor: pointer;
    }
    .search-suggestions {
        position: absolute;
        top: 105%;
        left: 0;
        right: 0;
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        z-index: 100;
        display: none;
    }
    .suggestion-item { padding: 12px 20px; cursor: pointer; }
    .suggestion-item:hover { background-color: #f6f6fa; }
    .banner-slider {
      margin: 20px auto;
      max-width: 1200px;
      border-radius: 20px;
      overflow: hidden;
      position: relative;
      box-shadow: 0 8px 32px #fe724c19;
    }
    .banner-slide { display: none; }
    .banner-slide.active { display: block; animation: fadeInBanner 0.7s; }
    .banner-slide img { width: 100%; display: block; }
    @keyframes fadeInBanner { from { opacity: 0.5; } to { opacity: 1; } }
    .banner-slider-controls {
        position: absolute;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 8px;
    }
    .banner-slider-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: rgba(255,255,255,0.6);
        cursor: pointer;
        transition: background 0.3s;
    }
    .banner-slider-dot.active { background: #fff; }
    .main-section {
      background: #fff;
      margin: 30px auto;
      padding: 30px;
      border-radius: var(--radius);
      max-width: 1200px;
      box-shadow: var(--shadow);
    }
    .section-title {
      font-size: 1.5rem;
      font-weight: 900;
      margin-bottom: 20px;
      color: #333;
    }
    .product-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 15px;
    }
    .product-controls .control-group { display: flex; align-items: center; gap: 10px; }
    .product-controls label { font-weight: 700; color: #333; }
    .product-controls select {
      padding: 8px 12px;
      border-radius: 10px;
      border: 2px solid var(--border);
      background-color: #fff;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
    }
    .mini-cart-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      display: none;
      animation: fadeIn 0.3s;
    }
    .mini-cart-overlay.active { display: block; }
    .mini-cart-drawer {
      position: fixed;
      top: 0; right: -400px;
      width: 350px; height: 100%;
      background: #fff;
      box-shadow: -5px 0 25px rgba(0,0,0,0.15);
      z-index: 2001;
      transition: right 0.4s cubic-bezier(0.25, 1, 0.5, 1);
      display: flex;
      flex-direction: column;
    }
    .mini-cart-drawer.active { right: 0; }
    .mini-cart-header {
      padding: 20px;
      border-bottom: 1px solid #eee;
      font-size: 1.2rem;
      font-weight: 700;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .mini-cart-close { cursor: pointer; font-size: 1.5rem; border: none; background: none; }
    .mini-cart-items { flex-grow: 1; overflow-y: auto; padding: 10px; }
    .mini-cart-item { display: flex; gap: 15px; padding: 10px; align-items: center; }
    .mini-cart-item-img { width: 60px; height: 60px; object-fit: contain; }
    .mini-cart-item-details { flex-grow: 1; }
    .mini-cart-item-title { font-weight: 700; }
    .mini-cart-footer { padding: 20px; border-top: 1px solid #eee; }
    .flying-image {
        position: fixed;
        z-index: 9999;
        border-radius: 10px;
        transition: all 0.7s cubic-bezier(0.5, 0, 0.9, 0.5);
    }
    .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 30px;
    }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    .product-card {
        background-color: #fff;
        border-radius: 16px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.06);
        border: 1px solid #eee;
        overflow: hidden;
        position: relative;
        display: flex;
        flex-direction: column;
        opacity: 0;
        animation: fadeInUp 0.6s ease-out forwards;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .product-card:hover { transform: translateY(-8px); box-shadow: 0 12px 28px rgba(0,0,0,0.1); }
    .card-image-container {
        height: 240px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #fafafa;
        padding: 20px;
        box-sizing: border-box;
        overflow: hidden;
    }
    .card-image { max-width: 100%; max-height: 100%; object-fit: contain; transition: transform 0.4s ease; }
    .product-card:hover .card-image { transform: scale(1.05); }
    .card-content-wrapper { padding: 20px; display: flex; flex-direction: column; flex-grow: 1; }
    .product-card .product-name { font-size: 1.1rem; font-weight: 700; color: #1a1a1a; line-height: 1.4; min-height: 46px; margin: 0 0 10px 0; }
    .tag-delivery { display: inline-block; background-color: var(--badge-green-light); color: var(--badge-green); padding: 4px 10px; font-size: 0.8rem; font-weight: 700; border-radius: 20px; margin-bottom: 12px; }
    .product-card .product-price { font-size: 1.4rem; font-weight: 900; color: var(--primary); margin-top: auto; }
    .card-buttons { display: flex; gap: 10px; margin-top: 15px; }
    .card-btn { border: 2px solid var(--primary-dark); border-radius: 8px; padding: 12px; font-size: 1rem; font-weight: 700; width: 100%; cursor: pointer; transition: background-color 0.2s, color 0.2s; text-decoration: none; text-align: center; }
    .card-btn.add-to-cart { background-color: #fff; color: var(--primary-dark); }
    .card-btn.buy-now { background-color: var(--primary-dark); color: #fff; }
    .card-btn.add-to-cart:hover { background-color: #fde8e0; }
    .card-btn.buy-now:hover { background-color: var(--accent); border-color: var(--accent); }
    .badge-hot { position: absolute; top: 10px; left: -10px; background: linear-gradient(45deg, var(--badge-red), var(--accent)); color: #fff; padding: 6px 12px 6px 20px; font-size: 0.85rem; font-weight: 900; border-radius: 0 20px 20px 0; box-shadow: 0 2px 8px rgba(255, 58, 94, 0.4); text-transform: uppercase; letter-spacing: 0.5px; z-index: 2; }
    .site-footer { background: #fff; color: #4a4a4a; padding: 50px 20px; margin-top: 40px; border-top: 4px solid var(--primary); box-shadow: 0 -4px 20px rgba(0,0,0,0.05); }
    .footer-grid { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 40px; }
    .footer-col h3 { font-size: 1.2rem; font-weight: 900; color: var(--primary-dark); margin-bottom: 15px; }
    .footer-col ul { list-style: none; padding: 0; margin: 0; }
    .footer-col ul li { margin-bottom: 10px; }
    .footer-col ul a { color: #555; text-decoration: none; font-weight: 700; transition: color 0.2s; }
    .footer-col ul a:hover { color: var(--primary); }
    .payment-methods-logos { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    .payment-methods-logos img { height: 30px; opacity: 0.8; }
    .footer-bottom { max-width: 1200px; margin: 40px auto 0 auto; padding-top: 20px; border-top: 1px solid #eee; text-align: center; font-weight: 700; color: #999; }
    .dw-bottom-nav { display: none; }
    #dwBackToTop { display: none; position: fixed; bottom: 80px; right: 20px; background: var(--primary); color: white; width: 45px; height: 45px; border-radius: 50%; border: none; cursor: pointer; z-index: 100; font-size: 1.5rem; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    /* --- MOBILE STYLES --- */
    @media (max-width: 900px) {
      .header-main-pro nav, .lang-currency-wrap .dropdown, .auth-btn, .account-btn { display: none; }
    }
    @media (max-width: 650px) {
      body { padding-bottom: 70px; }
      .header-main-pro { flex-direction: row; justify-content: space-between; }
      .search-bar-modern { display: none; }
      .lang-currency-wrap { display: none; }
      .cart-btn { display: none; }
      .product-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
      .card-image-container { height: 150px; }
      .card-content-wrapper { padding: 15px; }
      .product-card .product-name { font-size: 0.9rem; min-height: 38px; }
      .dw-bottom-nav {
        display: flex;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: white;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        z-index: 1000;
        justify-content: space-around;
        align-items: center;
      }
      .dw-bottom-nav a {
        color: #888;
        text-decoration: none;
        text-align: center;
        font-size: 0.8rem;
      }
      .dw-bottom-nav a.active { color: var(--primary); }
      .dw-bottom-nav .dw-nav-cart { position: relative; }
      .dw-bottom-nav .cart-icon-badge {
        position: absolute;
        top: -5px;
        right: -10px;
        font-size: 0.8rem;
        padding: 1px 6px;
      }
      #dwBackToTop { display: block; }
    }
  </style>
</head>
<body>
  
<header class="site-header">
  <div class="header-main-pro">
    <span class="logo-pro">DigiWorld</span>
    <nav>
      <a href="#" class="nav-link-pro active">Home</a>
      <a href="#" class="nav-link-pro">Products</a>
      <a href="#" class="nav-link-pro">Contact</a>
    </nav>
    <div class="lang-currency-wrap">
      <!-- Language Dropdown -->
      <div class="dropdown" id="langDropdown">
        <button class="dropdown-toggle"><span id="currentLangFlag">üá∫üá∏</span> <span id="currentLangLabel">EN</span></button>
        <div class="dropdown-menu">
          <div class="dropdown-item" data-lang="en" data-flag="üá∫üá∏">üá∫üá∏ English</div>
          <div class="dropdown-item" data-lang="si" data-flag="üá±üá∞">üá±üá∞ ‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω</div>
          <div class="dropdown-item" data-lang="ta" data-flag="üáÆüá≥">üáÆüá≥ ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</div>
          <div class="dropdown-item" data-lang="ru" data-flag="üá∑üá∫">üá∑üá∫ –†—É—Å—Å–∫–∏–π</div>
        </div>
      </div>
      <!-- Currency Dropdown -->
      <div class="dropdown" id="currencyDropdown">
        <button class="dropdown-toggle"><span id="currentCurrLabel">USD</span></button>
        <div class="dropdown-menu">
          <div class="dropdown-item" data-curr="USD" data-symbol="$">USD</div>
          <div class="dropdown-item" data-curr="LKR" data-symbol="Rs">LKR</div>
          <div class="dropdown-item" data-curr="INR" data-symbol="‚Çπ">INR</div>
          <div class="dropdown-item" data-curr="EUR" data-symbol="‚Ç¨">EUR</div>
        </div>
      </div>
      <!-- Auth Buttons -->
      <button id="loginBtn" class="auth-btn" style="display:none;">Login</button>
      <div id="accountDropdown" class="account-dropdown" style="display:none;">
          <button id="accountBtn" class="account-btn">Account</button>
          <div id="accountMenu" class="account-menu">
              <!-- Logged in user options here -->
          </div>
      </div>
      <!-- Cart Button -->
      <button class="cart-btn" id="cartBtn">
        <i class="fas fa-shopping-cart"></i>
        <span>Cart</span>
        <span class="cart-icon-badge" id="cartCount">0</span>
      </button>
    </div>
  </div>
</header>

<form class="search-bar-modern" autocomplete="off" onsubmit="return false;">
    <input type="text" id="searchInput" placeholder="Search for products...">
    <button class="search-btn-modern" type="submit">Search</button>
    <div class="search-suggestions" id="searchSuggestions"></div>
</form>

<div class="banner-slider" id="bannerSlider">
  <div class="banner-slide active"><img src="https://placehold.co/1200x400/f57224/ffffff?text=Huge+Sale+On+Digital+Keys" alt="Banner 1"></div>
  <div class="banner-slide"><img src="https://placehold.co/1200x400/fe724c/ffffff?text=Instant+Delivery" alt="Banner 2"></div>
  <div class="banner-slider-controls" id="bannerSliderControls"></div>
</div>

<main>
  <section class="main-section">
    <div class="product-controls">
      <div class="control-group">
        <label for="categoryFilter">Category:</label>
        <select id="categoryFilter">
          <option value="all">All</option>
          <option value="Office">Office</option>
          <option value="Windows">Windows</option>
          <option value="Development">Development</option>
        </select>
      </div>
      <div class="control-group">
        <label for="sortProducts">Sort by:</label>
        <select id="sortProducts">
          <option value="default">Default</option>
          <option value="price-asc">Price: Low to High</option>
          <option value="price-desc">Price: High to Low</option>
        </select>
      </div>
    </div>
    
    <div class="section-title">Featured Products</div>
    <div class="product-grid" id="productGrid"></div>
  </section>
</main>

<div class="mini-cart-overlay" id="miniCartOverlay"></div>
<div class="mini-cart-drawer" id="miniCartDrawer">
  <div class="mini-cart-header">
    <span>Your Cart</span>
    <button class="mini-cart-close" id="miniCartClose">&times;</button>
  </div>
  <div class="mini-cart-items" id="miniCartItems"></div>
  <div class="mini-cart-footer" id="miniCartFooter"></div>
</div>

<footer class="site-footer">
    <div class="footer-grid">
        <div class="footer-col">
            <h3>Customer Care</h3>
            <ul>
                <li><a href="#">FAQ</a></li>
                <li><a href="#">How to Buy</a></li>
                <li><a href="#">Refund Policy</a></li>
            </ul>
        </div>
        <div class="footer-col">
            <h3>About DigiWorld</h3>
            <ul>
                <li><a href="#">About Us</a></li>
                <li><a href="#">Contact Us</a></li>
                <li><a href="#">Terms & Conditions</a></li>
            </ul>
        </div>
        <div class="footer-col">
            <h3>We Accept</h3>
            <div class="payment-methods-logos">
                <img src="https://www.paypalobjects.com/webstatic/mktg/logo/AM_SbyPP_mc_vs_dc_ae.jpg" alt="PayPal and Credit Cards" title="PayPal and Credit Cards">
                <img src="https://nowpayments.io/images/nowpayments.svg" alt="NowPayments Crypto" title="NowPayments Crypto">
            </div>
        </div>
        <div class="footer-col">
            <h3>Stay Connected</h3>
            <p>Get exclusive deals and updates.</p>
        </div>
    </div>
    <div class="footer-bottom">
        &copy; 2025 DigiWorld. All rights reserved.
    </div>
</footer>

<nav class="dw-bottom-nav" id="dwBottomNav">
  <a href="#" class="active"><i class="fas fa-home"></i> Home</a>
  <a href="#"><i class="fas fa-search"></i> Search</a>
  <a href="#" class="dw-nav-cart" id="mobileCartBtn"><i class="fas fa-shopping-cart"></i> Cart <span class="cart-icon-badge" id="mobileCartCount">0</span></a>
  <a href="#" id="mobileAccountBtn"><i class="fas fa-user"></i> Account</a>
</nav>

<button id="dwBackToTop" title="Back to Top">‚Üë</button>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

<script>
// --- FIREBASE CONFIG ---
// IMPORTANT: Replace with your actual Firebase project configuration
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

// --- PRODUCT DATA ---
const products = [
  { id: "office365lifetime", category: "Office", isHot: false, name: { en: "Office 365 Lifetime Account (5 Devices)", si: "Office 365 ‡∂¢‡∑ì‡∑Ä‡∑í‡∂≠ ‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ú‡∑í‡∂´‡∑î‡∂∏", ta: "Office 365 ‡Æµ‡Ææ‡Æ¥‡Øç‡Æ®‡Ææ‡Æ≥‡Øç ‡Æï‡Æ£‡Æï‡Øç‡Æï‡ØÅ", ru: "Office 365 –ü–æ–∂–∏–∑–Ω–µ–Ω–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç" }, price: { LKR: 7700, USD: 23, INR: 1900, EUR: 21 }, image: "https://static-01.daraz.lk/p/ae3f76f0c47cf3b1c4099c857784b1de.jpg", delivery: { en: "Instant Delivery", si: "‡∂ö‡∑ä‡∑Ç‡∂´‡∑í‡∂ö ‡∂∂‡∑ô‡∂Ø‡∑è‡∑Ñ‡∑ê‡∂ª‡∑ì‡∂∏", ta: "‡Æâ‡Æü‡Æ©‡Æü‡Æø ‡Æµ‡Æø‡Æ®‡Æø‡ÆØ‡Øã‡Æï‡ÆÆ‡Øç", ru: "–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞" } },
  { id: "win10pro", category: "Windows", isHot: false, name: { en: "Windows 10 Pro Key", si: "Windows 10 Pro ‡∂∫‡∂≠‡∑î‡∂ª", ta: "Windows 10 Pro ‡Æµ‡Æø‡Æö‡Øà", ru: "–ö–ª—é—á Windows 10 Pro" }, price: { LKR: 3000, USD: 9, INR: 700, EUR: 8 }, image: "https://img.drz.lazcdn.com/static/lk/p/6089ff29fc089609833e9df6008ed942.png_400x400q75.avif", delivery: { en: "Instant Delivery", si: "‡∂ö‡∑ä‡∑Ç‡∂´‡∑í‡∂ö ‡∂∂‡∑ô‡∂Ø‡∑è‡∑Ñ‡∑ê‡∂ª‡∑ì‡∂∏", ta: "‡Æâ‡Æü‡Æ©‡Æü‡Æø ‡Æµ‡Æø‡Æ®‡Æø‡ÆØ‡Øã‡Æï‡ÆÆ‡Øç", ru: "–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞" } },
  { id: "win11pro", category: "Windows", isHot: true, name: { en: "Windows 11 Pro Key", si: "Windows 11 Pro ‡∂∫‡∂≠‡∑î‡∂ª", ta: "Windows 11 Pro ‡Æµ‡Æø‡Æö‡Øà", ru: "–ö–ª—é—á Windows 11 Pro" }, price: { LKR: 3700, USD: 11, INR: 860, EUR: 10 }, image: "https://img.drz.lazcdn.com/static/lk/p/4ac77c5340b852dcfe5d0f0ba66fb1ed.png_400x400q75.avif", delivery: { en: "Instant Delivery", si: "‡∂ö‡∑ä‡∑Ç‡∂´‡∑í‡∂ö ‡∂∂‡∑ô‡∂Ø‡∑è‡∑Ñ‡∑ê‡∂ª‡∑ì‡∂∏", ta: "‡Æâ‡Æü‡Æ©‡Æü‡Æø ‡Æµ‡Æø‡Æ®‡Æø‡ÆØ‡Øã‡Æï‡ÆÆ‡Øç", ru: "–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞" } },
  { id: "office2021", category: "Office", isHot: false, name: { en: "Office 2021 Pro Plus Key", si: "Office 2021 Pro Plus ‡∂∫‡∂≠‡∑î‡∂ª", ta: "Office 2021 Pro Plus ‡Æµ‡Æø‡Æö‡Øà", ru: "–ö–ª—é—á Office 2021 Pro Plus" }, price: { LKR: 4500, USD: 13, INR: 1100, EUR: 12 }, image: "https://img.drz.lazcdn.com/g/kf/Sb9bc8d1802a04d8394d16f951736c65a2.jpg_400x400q75.avif", delivery: { en: "Instant Delivery", si: "‡∂ö‡∑ä‡∑Ç‡∂´‡∑í‡∂ö ‡∂∂‡∑ô‡∂Ø‡∑è‡∑Ñ‡∑ê‡∂ª‡∑ì‡∂∏", ta: "‡Æâ‡Æü‡Æ©‡Æü‡Æø ‡Æµ‡Æø‡Æ®‡Æø‡ÆØ‡Øã‡Æï‡ÆÆ‡Øç", ru: "–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞" } },
  { id: "project2021", category: "Development", isHot: false, name: { en: "Microsoft Project Pro 2021 Key", si: "Microsoft Project Pro 2021 ‡∂∫‡∂≠‡∑î‡∂ª", ta: "Microsoft Project Pro 2021 ‡Æµ‡Æø‡Æö‡Øà", ru: "–ö–ª—é—á Project Pro 2021" }, price: { LKR: 5200, USD: 15, INR: 1200, EUR: 14 }, image: "https://img.drz.lazcdn.com/g/kf/S418dd45f61604ef8a7be51cd7190ffec3.jpg_400x400q75.avif", delivery: { en: "Instant Delivery", si: "‡∂ö‡∑ä‡∑Ç‡∂´‡∑í‡∂ö ‡∂∂‡∑ô‡∂Ø‡∑è‡∑Ñ‡∑ê‡∂ª‡∑ì‡∂∏", ta: "‡Æâ‡Æü‡Æ©‡Æü‡Æø ‡Æµ‡Æø‡Æ®‡Æø‡ÆØ‡Øã‡Æï‡ÆÆ‡Øç", ru: "–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞" } }
];

document.addEventListener('DOMContentLoaded', function() {
    // --- STATE & CONSTANTS ---
    let currentLang = 'en';
    let currentCurr = 'USD';
    let cart = JSON.parse(localStorage.getItem('digiworldCart')) || {};
    const currencySymbols = { USD: '$', LKR: 'Rs', INR: '‚Çπ', EUR: '‚Ç¨' };
    const langData = {
        en: { flag: 'üá∫üá∏', label: 'EN' },
        si: { flag: 'üá±üá∞', label: '‡∑É‡∑í‡∂Ç' },
        ta: { flag: 'üáÆüá≥', label: ' ‡Æ§‡ÆÆ‡Æø' },
        ru: { flag: 'üá∑üá∫', label: 'RU' }
    };

    // --- DOM ELEMENTS ---
    const productGrid = document.getElementById('productGrid');
    const categoryFilter = document.getElementById('categoryFilter');
    const sortProductsControl = document.getElementById('sortProducts');
    const cartBtn = document.getElementById('cartBtn');
    const cartCountEl = document.getElementById('cartCount');
    const mobileCartCountEl = document.getElementById('mobileCartCount');
    const miniCartOverlay = document.getElementById('miniCartOverlay');
    const miniCartDrawer = document.getElementById('miniCartDrawer');
    const miniCartClose = document.getElementById('miniCartClose');
    const miniCartItems = document.getElementById('miniCartItems');
    const miniCartFooter = document.getElementById('miniCartFooter');
    const header = document.querySelector('header.site-header');
    const backToTopBtn = document.getElementById('dwBackToTop');
    const searchInput = document.getElementById('searchInput');
    const searchSuggestions = document.getElementById('searchSuggestions');
    
    // --- AUTH UI ELEMENTS ---
    const loginBtn = document.getElementById('loginBtn');
    const accountDropdown = document.getElementById('accountDropdown');
    const accountBtn = document.getElementById('accountBtn');
    const accountMenu = document.getElementById('accountMenu');
    const mobileAccountBtn = document.getElementById('mobileAccountBtn');

    // --- RENDER FUNCTIONS ---
    function renderProducts(list) {
        if (!productGrid) return;
        productGrid.innerHTML = list.map((prod, index) => {
            const name = prod.name[currentLang] || prod.name['en'];
            const price = (prod.price[currentCurr] || prod.price['USD']);
            const deliveryText = prod.delivery[currentLang] || prod.delivery['en'];
            return `
                <div class="product-card" data-product-id="${prod.id}" style="animation-delay: ${index * 0.05}s;">
                    ${prod.isHot ? '<div class="badge-hot">Hot</div>' : ''}
                    <div class="card-image-container">
                        <img class="card-image" src="${prod.image}" alt="${name}" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/400x400/eee/ccc?text=Image+Not+Found';">
                    </div>
                    <div class="card-content-wrapper">
                        <h3 class="product-name">${name}</h3>
                        <div class="tag-delivery">${deliveryText}</div>
                        <p class="product-price">${currencySymbols[currentCurr] || '$'}${price.toFixed(2)}</p>
                        <div class="card-buttons">
                            <button class="card-btn add-to-cart" data-id="${prod.id}">Add to Cart</button>
                            <a href="#" class="card-btn buy-now" data-id="${prod.id}">Buy Now</a>
                        </div>
                    </div>
                </div>`;
        }).join('');
    }

    function renderMiniCart() {
        const items = Object.entries(cart);
        if (items.length === 0) {
            miniCartItems.innerHTML = '<p style="text-align:center; padding: 20px;">Your cart is empty.</p>';
            miniCartFooter.innerHTML = '';
            return;
        }
        let total = 0;
        miniCartItems.innerHTML = items.map(([id, qty]) => {
            const prod = products.find(p => p.id === id);
            if (!prod) return '';
            const price = (prod.price[currentCurr] || prod.price['USD']);
            total += price * qty;
            return `
                <div class="mini-cart-item">
                    <img src="${prod.image}" class="mini-cart-item-img" alt="${prod.name.en}">
                    <div class="mini-cart-item-details">
                        <div class="mini-cart-item-title">${prod.name[currentLang] || prod.name.en}</div>
                        <div>Qty: ${qty} | Price: ${currencySymbols[currentCurr]}${(price * qty).toFixed(2)}</div>
                    </div>
                </div>`;
        }).join('');
        miniCartFooter.innerHTML = `<strong>Total: ${currencySymbols[currentCurr]}${total.toFixed(2)}</strong>`;
    }

    // --- CORE LOGIC ---
    function applyFiltersAndSorting() {
        let filteredProducts = [...products];
        const category = categoryFilter.value;
        if (category !== 'all') {
            filteredProducts = filteredProducts.filter(p => p.category === category);
        }
        const sortValue = sortProductsControl.value;
        if (sortValue === 'price-asc') {
            filteredProducts.sort((a, b) => (a.price[currentCurr] || a.price.USD) - (b.price[currentCurr] || b.price.USD));
        } else if (sortValue === 'price-desc') {
            filteredProducts.sort((a, b) => (b.price[currentCurr] || b.price.USD) - (a.price[currentCurr] || a.price.USD));
        }
        renderProducts(filteredProducts);
    }

    function updateCart() {
        localStorage.setItem('digiworldCart', JSON.stringify(cart));
        const count = Object.values(cart).reduce((sum, q) => sum + q, 0);
        cartCountEl.textContent = count;
        if (mobileCartCountEl) mobileCartCountEl.textContent = count;
        renderMiniCart();
    }
    
    function animateImageToCart(event) {
        const button = event.target.closest('.card-btn');
        const card = button.closest('.product-card');
        const targetCartIcon = window.innerWidth <= 650 ? document.getElementById('mobileCartBtn') : cartBtn;
        if (!card || !targetCartIcon) return;
        const productImage = card.querySelector('.card-image');
        const startRect = productImage.getBoundingClientRect();
        const endRect = targetCartIcon.getBoundingClientRect();
        const flyingImage = productImage.cloneNode(true);
        flyingImage.classList.add('flying-image');
        document.body.appendChild(flyingImage);
        Object.assign(flyingImage.style, { left: `${startRect.left}px`, top: `${startRect.top}px`, width: `${startRect.width}px`, height: `${startRect.height}px` });
        requestAnimationFrame(() => {
            Object.assign(flyingImage.style, { left: `${endRect.left + endRect.width / 2}px`, top: `${endRect.top + endRect.height / 2}px`, width: '20px', height: '20px', transform: 'scale(0.1)', opacity: '0' });
        });
        flyingImage.addEventListener('transitionend', () => flyingImage.remove());
    }

    // --- AUTHENTICATION LOGIC ---
    auth.onAuthStateChanged(user => {
        if (user) {
            // User is signed in
            loginBtn.style.display = 'none';
            accountDropdown.style.display = 'inline-block';
            accountMenu.innerHTML = `
                <a href="#">My Profile</a>
                <a href="#">My Orders</a>
                <button id="logoutBtn">Logout</button>
            `;
            document.getElementById('logoutBtn').addEventListener('click', () => auth.signOut());
            if (mobileAccountBtn) mobileAccountBtn.href = "#"; // Update mobile link
        } else {
            // User is signed out
            loginBtn.style.display = 'inline-block';
            accountDropdown.style.display = 'none';
            if (mobileAccountBtn) mobileAccountBtn.href = "#"; // Update mobile link to login
        }
    });

    // --- EVENT LISTENERS ---
    categoryFilter.addEventListener('change', applyFiltersAndSorting);
    sortProductsControl.addEventListener('change', applyFiltersAndSorting);

    productGrid.addEventListener('click', e => {
        const button = e.target.closest('.card-btn');
        if (!button) return;
        const id = button.dataset.id;
        if (button.classList.contains('add-to-cart')) {
            cart[id] = (cart[id] || 0) + 1;
            animateImageToCart(e);
            updateCart();
        }
    });
    
    const openCart = () => {
        miniCartOverlay.classList.add('active');
        miniCartDrawer.classList.add('active');
    };
    const closeCart = () => {
        miniCartOverlay.classList.remove('active');
        miniCartDrawer.classList.remove('active');
    };
    cartBtn.addEventListener('click', openCart);
    document.getElementById('mobileCartBtn')?.addEventListener('click', openCart);
    miniCartClose.addEventListener('click', closeCart);
    miniCartOverlay.addEventListener('click', closeCart);

    // Dropdown Logic
    document.querySelectorAll('.dropdown-toggle').forEach(toggle => {
        toggle.addEventListener('click', (e) => {
            e.stopPropagation();
            const dropdown = toggle.closest('.dropdown');
            const isAccount = dropdown.id === 'accountDropdown';
            // Close other dropdowns
            document.querySelectorAll('.dropdown.open').forEach(d => {
                if(d !== dropdown) d.classList.remove('open');
            });
            dropdown.classList.toggle('open');
        });
    });

    document.getElementById('langDropdown').addEventListener('click', e => {
        if (e.target.matches('.dropdown-item')) {
            currentLang = e.target.dataset.lang;
            const { flag, label } = langData[currentLang];
            document.getElementById('currentLangFlag').textContent = flag;
            document.getElementById('currentLangLabel').textContent = label;
            applyFiltersAndSorting();
            renderMiniCart();
        }
    });

    document.getElementById('currencyDropdown').addEventListener('click', e => {
        if (e.target.matches('.dropdown-item')) {
            currentCurr = e.target.dataset.curr;
            document.getElementById('currentCurrLabel').textContent = currentCurr;
            applyFiltersAndSorting();
            renderMiniCart();
        }
    });
    
    document.addEventListener('click', () => document.querySelectorAll('.dropdown.open').forEach(d => d.classList.remove('open')));

    // Search Logic
    searchInput.addEventListener('input', () => {
        const query = searchInput.value.toLowerCase();
        if (query.length < 2) {
            searchSuggestions.style.display = 'none';
            return;
        }
        const results = products.filter(p => (p.name[currentLang] || p.name.en).toLowerCase().includes(query));
        if (results.length > 0) {
            searchSuggestions.innerHTML = results.map(p => `<div class="suggestion-item" data-id="${p.id}">${p.name[currentLang] || p.name.en}</div>`).join('');
            searchSuggestions.style.display = 'block';
        } else {
            searchSuggestions.style.display = 'none';
        }
    });
    searchSuggestions.addEventListener('click', e => {
        if(e.target.matches('.suggestion-item')) {
            // Redirect to product page or handle selection
            console.log('Selected product:', e.target.dataset.id);
            searchSuggestions.style.display = 'none';
            searchInput.value = '';
        }
    });

    // Scroll-based UI changes
    let lastScrollY = window.scrollY;
    window.addEventListener('scroll', () => {
        if (window.scrollY > 100) {
            if (window.scrollY > lastScrollY) {
                header.classList.add('header-hidden');
            } else {
                header.classList.remove('header-hidden');
            }
            backToTopBtn.style.display = 'block';
        } else {
            header.classList.remove('header-hidden');
            backToTopBtn.style.display = 'none';
        }
        lastScrollY = window.scrollY;
    });
    backToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

    // Banner Slider
    const slides = document.querySelectorAll('.banner-slide');
    const dotsContainer = document.getElementById('bannerSliderControls');
    let currentSlide = 0;
    let slideInterval;

    function showSlide(index) {
        slides.forEach((slide, i) => slide.classList.toggle('active', i === index));
        document.querySelectorAll('.banner-slider-dot').forEach((dot, i) => dot.classList.toggle('active', i === index));
        currentSlide = index;
    }

    function nextSlide() { showSlide((currentSlide + 1) % slides.length); }
    
    function startSlider() {
        stopSlider();
        slideInterval = setInterval(nextSlide, 5000);
    }
    function stopSlider() { clearInterval(slideInterval); }

    if (slides.length > 1) {
        slides.forEach((_, i) => {
            const dot = document.createElement('div');
            dot.classList.add('banner-slider-dot');
            if (i === 0) dot.classList.add('active');
            dot.addEventListener('click', () => {
                showSlide(i);
                startSlider(); // Reset timer on manual navigation
            });
            dotsContainer.appendChild(dot);
        });
        startSlider();
    }

    // --- INITIAL LOAD ---
    applyFiltersAndSorting();
    updateCart();
});
</script>
</body>
</html>
